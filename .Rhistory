install.packages("dplyr")
install.packages("tidyr")
install.packages("ggplot2")
install.packages("shiny")
a=c(1,2,3,4,5)
a
a[a>3]=3
a
a[a<2]=2
a
b=a
b
a=c(1,2,3,4,5)
b=a
b[a<2]=2
b
b[a>3]=3
b
a
findInterval(a,0:6)
a %in% 0:6
!a
0.2:03
0.2:0.3
range(2)
range(4)
range(2,4)
a
cbind(a>1.9,a<3.2)
cbind(a>1.9&a<3.2)
c=cbind(a>1.9&a<3.2)
class(c)
c=cbind(a>1.9&a<3.2, drop=TRUE)
c
c=cbind(a>1.9&a<3.2)
c
a
(a>1.9)&(a<3.1)
a
b
install.packages("asbio")
require(asbio)
install.packages("asbio")
install.packages("tkrplot")
require(MASS)
cov.mve(a,b,cor=TRUE)
cor(a,b)
cor(a,b,method="spearman")
cor(a,b,method="pearson")
cor(a,b,method="kendall")
cov.mve(a,b,cor=TRUE)
d=rnorm(10)
e=rnorm(10)
cov.mve(d,e,cor=TRUE)
?cov.mve
dir()
dd = readRDS('Documents/createAlns/results/permuteRER/perm_rer_corr1.RDS')
str(dd)
head(dd)
dd$r
dd$r['LIM2']
dd$r[LIM2]
head(dd$r)
dd$r[LIM2,]
dd$r['LIM2',]
bh
??bh
fdr
?fdr
??fdr
source('~/Documents/coevolution/code/analysetoppairs.R')
setwd("~/Documents/coevolution/code")
source('~/Documents/erc/code/funcsERCfromProjections.R')
hsap.genes <- readLines('../data/hsap.genes')
intfterc <- readRDS('../data/allsum.fterc.rds')
merc.sym <- readRDS('~/Documents/erc/data/saves/mamm63nt.trees.fterc.symm.rds')
pairmap <- readRDS('../data/pairmapmat.rds')
dgg.u <- readRDS('../data/public/omimcplxs.cleaned.rds')
#dgg.u$df$ndata <- calcpairid(dgg.u$df$V1,dgg.u$df$V2,ndatafterc)
View(dgg.u$df)
dgg.df.summ <- group_by(dgg.u$df, cplxid) %>%
summarise(meanintscore = mean(interc, na.rm = T),
meanmerc = mean(merc, na.rm = T))
randfiles <- dir('../data/randoms/omimcplxs.cleaned/')
randcplxdfsumm <- do.call('rbind',lapply(randfiles, function(x){
fread(file.path('../data/randoms/omimcplxs.cleaned',x))
}))
#head(randcplxdfsumm)
# randcplxdfsumm.mean <- group_by(randcplxdfsumm, cplxid) %>%
#      summarise(meanofmeans = mean(medianscore, na.rm = T))
dgg.df.summ$pvint <- sapply(1:nrow(dgg.df.summ), function(x){
mean(filter(dgg.df.summ, cplxid == x)$meanintscore<=filter(randcplxdfsumm,cplxid == x)$meanintscore,
na.rm = T)
})
dgg.df.summ$pvmamm <- sapply(1:nrow(dgg.df.summ), function(x){
mean(filter(dgg.df.summ, cplxid == x)$meanmerc<=filter(randcplxdfsumm,cplxid == x)$meanmerc,
na.rm = T)
})
dgg.df.summ$pvint[dgg.df.summ$pvint == 0] <- 1e-06
dgg.df.summ$pvmamm[dgg.df.summ$pvmamm == 0] <- 1e-06
dgg.df.summ$names <- names(dgg.u$cplx)
dgg.df.summ$ngenes <- sapply(dgg.u$cplx, length)
dgg.df.summ$qvint <- p.adjust(dgg.df.summ$pvint, method = 'BH')
dgg.df.summ$qvmamm <- p.adjust(dgg.df.summ$pvmamm, method = 'BH')
head(dgg.df.summ)
dgg.df.summ <- select(dgg.df.summ,c(1,6,7,2:5,8,9))
setnames(dgg.df.summ, c('Complex.ID','Disease group','nGenes','Mean.Integrated.ERC','Mean.Mammal.ERC','P.value.Integrated','P.value.Mammal','Q.value.Integrated',
'Q.value.Mammal'))
runroc.intvsmamm <- function(true.erc.df, bgd.erc.df,plot=F,titl = ''){
true.erc.df$lbl <- 1
bgd.erc.df$lbl <- 0
colids <- c('lbl','merc','interc')
nb.df <- rbind(dplyr::select(true.erc.df,colids), dplyr::select(bgd.erc.df,colids))
nb.df$lbl <- factor(nb.df$lbl)
fg <- filter(nb.df, lbl == 1)$interc
bg <- filter(nb.df, lbl == 0)$interc
fg_mammonly <- filter(nb.df, lbl == 1)$merc
bg_mammonly <- filter(nb.df, lbl == 0)$merc
pr <- roc.curve(scores.class0 = fg[!is.na(fg)], scores.class1 = bg[!is.na(bg)], curve = T)
pr2 <- roc.curve(scores.class0 = fg_mammonly[!is.na(fg_mammonly)], scores.class1 = bg_mammonly[!is.na(bg_mammonly)], curve = T)
if(plot){
plot(pr$curve[,1],pr$curve[,2],xlim = c(0,1), type = 'l',col='red',xlab='FPR',ylab='TPR',lwd = 2,main = '',
cex.lab = 1.25)
title(titl, font.main = 1, cex.main = 1.5, adj = 0)
lines(pr2$curve[,1],pr2$curve[,2],xlim = c(0,1), lwd = 2)
abline(a = 0,b=1,lty = 2)
legend('bottomright', c(paste0('Integrated: AUC = ',round(pr$auc, 3)),paste0('Mammal: AUC = ',round(pr2$auc, 3))),
title = 'ERC', pch = 19,col = c('red','black'),bty='n', title.adj = 0.5,cex=1.25)
}
return(list(int.auc = pr$auc,mamm.auc = pr2$auc))
}
dgg.df.summ.forroc <- select(dgg.df.summ, c(4,5))
setnames(dgg.df.summ.forroc, c('interc','merc'))
setnames(randcplxdfsumm,c('cplxid','dataset','interc','merc'))
pdf('../figures/aurocs/omimvsrandom.pdf',width = 5,height = 5,family = 'FreeSans')
runroc.intvsmamm(dgg.df.summ.forroc, filter(randcplxdfsumm, dataset <= 10),plot = T, titl = '')
dev.off()
pdf('../figures/pvals/omimvsrandom.pdf',width = 5,height = 5,family = 'FreeSans')
hist(dgg.df.summ$P.value.Integrated, breaks = 25, probability = T, xlab = 'p-value', col = rgb(1,0,0,0.25), main = '')
hist(dgg.df.summ$P.value.Mammal, breaks = 25, probability = T, col = rgb(0,0,0,0.25), add = T)
title('A',adj = 0, font.main = 1,cex.main = 1.5)
legend('right',c('Integrated','Mammal'),title = 'ERC',col = c('red','black'),lty = 1,bty='n')
dev.off()
