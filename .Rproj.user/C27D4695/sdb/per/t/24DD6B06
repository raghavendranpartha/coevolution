{
    "contents" : "library(RERconverge)\nrequire(dplyr)\nrequire(data.table)\nhsap.genes <- readLines('../data/hsap.genes')\nhsap.vert.genes <- readLines('../data/hsap.vert.genes')\nhsap.dmel.genes <- readLines('../data/hsap.dmel.genes')\nhsap.cele.genes <- readLines('../data/hsap.cele.genes')\nhsap.scer.genes <- readLines('../data/hsap.scer.genes')\n\nmbeta <- readRDS('../data/ercbetafit/mammalercbetafit.rds')$est\nvbeta <- readRDS('../data/ercbetafit/vertercbetafit.rds')$est\nwbeta <- readRDS('../data/ercbetafit/wormercbetafit.rds')$est\ndbeta <- readRDS('../data/ercbetafit/dmelercbetafit.rds')$est\nybeta <- readRDS('../data/ercbetafit/scerercbetafit.rds')$est\n\n\ngenepresence <- (hsap.genes %in% hsap.vert.genes)+(hsap.genes %in% hsap.dmel.genes)+(hsap.genes %in% hsap.scer.genes)+(hsap.genes %in% hsap.cele.genes)\nnames(genepresence) = hsap.genes\ntable(genepresence)\ngenesinmorethanonedataset <- hsap.genes[which(genepresence>1)]\ncommonpairs <- as.data.frame(t(combn(genesinmorethanonedataset,2)), stringsAsFactors = F)\ncommonpairs$gene1c = genepresence[commonpairs$V1]\ncommonpairs$gene2c = genepresence[commonpairs$V2]\ncommonpairs$pairc = with(commonpairs, gene1c+gene2c)\ncommonpairs <- arrange(commonpairs, desc(pairc))\n\nhead(commonpairs, 20)\n\nnpairs <- 1000\ntestpairs <- commonpairs[1:npairs,]\n\n\n\n#commongenes <- intersect(intersect(hsap.vert.genes,hsap.dmel.genes),hsap.scer.genes)\n\nflymap <- fread('../data/dmel.hsap.geneIDsUniProtIDs.map')\nyeastmap <- fread('../data/hsap.scer.geneIDsUniProtIDs.map')\nwormmap <- fread('../data/cele.OgwbgnUniprotSymbol.map')\nwormmap.vec <- wormmap$og\nnames(wormmap.vec) <- wormmap$symbol\nflymap.vec <- flymap$og\nnames(flymap.vec) <- flymap$hsapsymbol\nyeastmap.vec <- yeastmap$scersymbol\nnames(yeastmap.vec) <- yeastmap$hsapsymbol\n\ngetercasvec <- function(mat, gen){\n     #mat <- merc\n     genv <- match(gen,rownames(mat))\n     genord <- gen[order(genv)]\n     out <- mat[genord,genord][lower.tri(mat[genord,genord], diag = F)]\n     out[is.infinite(out)] <- NA\n     out\n}\n\ngetercbetapval <- function(mat, sh1, sh2,gen){\n     #mat <- merc\n     genv <- match(gen,rownames(mat))\n     genord <- gen[order(genv)]\n     out <- mat[genord,genord][lower.tri(mat[genord,genord], diag = F)]\n     out[is.infinite(out)] <- NA\n     out\n}\n\n\ncommonpairserc <- sapply(c(1:nrow(testpairs)), function(x){\n     #x <- 1\n     #gen1 <- commonpairs[x,1]\n     #gen2 <- commonpairs[x,2]\n     #x <- 1\n     c(getercasvec(merc, c(commonpairs$V1[x],commonpairs$V2[x])),\n       getercasvec(verc, c(commonpairs$V1[x],commonpairs$V2[x])),\n       getercasvec(werc, wormmap.vec[c(commonpairs$V1[x],commonpairs$V2[x])]),\n       getercasvec(derc, flymap.vec[c(commonpairs$V1[x],commonpairs$V2[x])]),\n       getercasvec(yerc, yeastmap.vec[c(commonpairs$V1[x],commonpairs$V2[x])]))\n})\n\ntestpairs.score <- cbind(testpairs, t(commonpairserc)) %>%\n     setnames(c('gene1','gene2','gene1c','gene2c','pairc','merc','verc','werc','derc','yerc')) %>%\n     mutate(msc = -log(pbeta(merc,mbeta[1],mbeta[2],lower.tail = F),10)) %>%\n     mutate(vsc = -log(pbeta(verc,vbeta[1],vbeta[2],lower.tail = F),10)) %>%\n     mutate(wsc = -log(pbeta(werc,wbeta[1],wbeta[2],lower.tail = F),10)) %>%\n     mutate(dsc = -log(pbeta(derc,dbeta[1],dbeta[2],lower.tail = F),10)) %>%\n     mutate(ysc = -log(pbeta(yerc,ybeta[1],ybeta[2],lower.tail = F),10)) %>%\n     rowwise() %>% mutate(sc = sum(c(msc,vsc,wsc,dsc,ysc), na.rm = T)) %>%\n     select(c(1:5,16,6:15))\n\nsumerc <- colSums(commonpairserc, na.rm = T)\nquantile(sumerc)\nsum(sumerc > 1)\n\nsaveRDS(list(genes = commongenes, pairs = commonpairs, erc = commonpairserc), file = 'CommonGenePairsErc.rds')",
    "created" : 1551462523423.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3517052338",
    "id" : "24DD6B06",
    "lastKnownWriteTime" : 1551463260,
    "path" : "~/Documents/coevolution/code/combinederc.R",
    "project_path" : "combinederc.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}